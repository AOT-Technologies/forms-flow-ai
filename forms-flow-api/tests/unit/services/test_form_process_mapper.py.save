"""Tests to assure the FormProcessMapper Service"""
from formsflow_api.services import FormProcessMapperService
from tests.utilities.base_test import (
    get_form_service_payload,
    get_form_request_payload,
    factory_auth_header,
)

form_service = FormProcessMapperService()


def test_form_get_all_mappers():
    rv = form_service.get_all_mappers(page_number=0, limit=0)
    assert not rv


def test_get_form_mapper_count():
    rv = form_service.get_mapper_count()
    assert not rv
    assert type(rv) == int


def test_get_form_mapper(client):
    token = factory_auth_header()
    headers = {"Authorization": f"Bearer {token}", "content-type": "application/json"}
    response = client.post("/form", headers=headers, json=get_form_request_payload())
    assert response.status_code == 201

    mapper_id = response.json.get("id")
    rv = form_service.get_mapper(mapper_id)
    assert not rv


def test_get_form_mapper_by_formid(client):
    token = factory_auth_header()
    headers = {"Authorization": f"Bearer {token}", "content-type": "application/json"}
    response = client.post("/form", headers=headers, json=get_form_request_payload())
    assert response.status_code == 201

    mapper_form_id = response.json.get("form_id")
    rv = form_service.get_mapper_by_formid(mapper_form_id)
    assert not rv


def test_create_form_mapper():
    rv = form_service.create_mapper(data=get_form_service_payload())
    assert rv.form_id == "1234"
    assert rv.form_name == "Sample form"


def test_update_form_mapper(session, client):
    rv = form_service.update_mapper(1, data=get_form_service_payload())
    assert rv.form_id == "1234"
    assert rv.form_name == "Sample form"


def test_mark_inactive(session):
    rv = form_service.mark_inactive(form_process_mapper_id=1)
    assert rv.status_code == 200

