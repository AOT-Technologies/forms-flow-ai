<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_17ytju0" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.6.0">
  <bpmn:collaboration id="Collaboration_01drroj">
    <bpmn:participant id="Participant_1tv1lnj" name="Two Step Approval" processRef="two-step-approval" />
  </bpmn:collaboration>
  <bpmn:process id="two-step-approval" name="Two Step Approval" isExecutable="true">
    <bpmn:laneSet id="LaneSet_1e6v5og">
      <bpmn:lane id="Lane_0t984kw" name="Client/Submitter">
        <bpmn:flowNodeRef>StartEvent_1</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>ExclusiveGateway_0xgo1b6</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>IntermediateThrowEvent_0mxbwgy</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_1eegye4" name="Sraff Group - Clerk">
        <bpmn:flowNodeRef>Clerk</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_0cw9gba" name="Staff Group - Approver">
        <bpmn:flowNodeRef>Approver</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_1v2yre2</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:startEvent id="StartEvent_1" name="SubmitÂ  New Application">
      <bpmn:extensionElements>
        <camunda:executionListener event="start">
          <camunda:script scriptFormat="javascript">execution.setVariable('applicationStatus', "new");</camunda:script>
        </camunda:executionListener>
      </bpmn:extensionElements>
      <bpmn:outgoing>SequenceFlow_0byzagb</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="Clerk" name="Review Applications" camunda:candidateGroups="Clerk">
      <bpmn:extensionElements>
        <camunda:taskListener class="org.camunda.bpm.extension.hooks.listeners.task.NotifyListener" event="create">
          <camunda:field name="messageId">
            <camunda:string>Message_Email</camunda:string>
          </camunda:field>
          <camunda:field name="category">
            <camunda:string>submission_notification</camunda:string>
          </camunda:field>
        </camunda:taskListener>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0byzagb</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_009hwyx</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0xvu6g6</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1hwdics</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_0byzagb" sourceRef="StartEvent_1" targetRef="Clerk">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript">execution.setVariable('applicationStatus', 'New');</camunda:script>
        </camunda:executionListener>
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.execution.FormAttributesListener" event="take" />
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.ApplicationStateListener" event="take" />
      </bpmn:extensionElements>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="Approver" name="Approve/Reject Applications" camunda:candidateGroups="Approver">
      <bpmn:extensionElements>
        <camunda:taskListener class="org.camunda.bpm.extension.hooks.listeners.task.NotifyListener" event="create">
          <camunda:field name="messageId">
            <camunda:string>Message_Email</camunda:string>
          </camunda:field>
          <camunda:field name="category">
            <camunda:string>submission_notification</camunda:string>
          </camunda:field>
        </camunda:taskListener>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0xvu6g6</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_07hh4hx</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_08bp69k</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_0ppj3wo</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_0xvu6g6" name="Reviewed" sourceRef="Clerk" targetRef="Approver">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript">execution.setVariable('application_status', "Reviewed");</camunda:script>
        </camunda:executionListener>
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.FormSubmissionListener" event="take" />
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.ApplicationStateListener" event="take" />
      </bpmn:extensionElements>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${action == 'Reviewed'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_08bp69k" name="Approved/Rejected" sourceRef="Approver" targetRef="EndEvent_1v2yre2">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript">execution.setVariable('applicationStatus', execution.getVariable('action'));</camunda:script>
        </camunda:executionListener>
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.ApplicationStateListener" event="take" />
      </bpmn:extensionElements>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${action == 'Approved' || action == 'Rejected'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="EndEvent_1v2yre2">
      <bpmn:incoming>SequenceFlow_08bp69k</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_1hwdics" name="Returned" sourceRef="Clerk" targetRef="IntermediateThrowEvent_0mxbwgy">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript">execution.setVariable('applicationStatus', "Returned");
execution.setVariable('sendback_by', "Clerk");</camunda:script>
        </camunda:executionListener>
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.FormSubmissionListener" event="take" />
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.ApplicationStateListener" event="take" />
      </bpmn:extensionElements>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${action == 'Returned'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_0ppj3wo" name="Returned" sourceRef="Approver" targetRef="IntermediateThrowEvent_0mxbwgy">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript">execution.setVariable('applicationStatus', "Returned");
execution.setVariable('sendback_by', "Approver");</camunda:script>
        </camunda:executionListener>
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.FormSubmissionListener" event="take" />
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.ApplicationStateListener" event="take" />
      </bpmn:extensionElements>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${action == 'Returned'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_08cf9rf" sourceRef="IntermediateThrowEvent_0mxbwgy" targetRef="ExclusiveGateway_0xgo1b6" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_0xgo1b6">
      <bpmn:incoming>SequenceFlow_08cf9rf</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_009hwyx</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_07hh4hx</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_009hwyx" name="Resubmitted" sourceRef="ExclusiveGateway_0xgo1b6" targetRef="Clerk">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript">execution.setVariable('applicationStatus', "Resubmitted");</camunda:script>
        </camunda:executionListener>
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.ApplicationStateListener" event="take" />
      </bpmn:extensionElements>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${sendback_by == 'Clerk'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_07hh4hx" name="Resubmitted" sourceRef="ExclusiveGateway_0xgo1b6" targetRef="Approver">
      <bpmn:extensionElements>
        <camunda:executionListener event="take">
          <camunda:script scriptFormat="javascript">execution.setVariable('applicationStatus', "Resubmitted");</camunda:script>
        </camunda:executionListener>
        <camunda:executionListener class="org.camunda.bpm.extension.hooks.listeners.ApplicationStateListener" event="take" />
      </bpmn:extensionElements>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${sendback_by == 'Approver'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:intermediateCatchEvent id="IntermediateThrowEvent_0mxbwgy">
      <bpmn:incoming>SequenceFlow_1hwdics</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_0ppj3wo</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_08cf9rf</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1tj95qc" messageRef="Message_1ngb2eg" />
    </bpmn:intermediateCatchEvent>
  </bpmn:process>
  <bpmn:message id="Message_1ngb2eg" name="application_resubmitted" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_01drroj">
      <bpmndi:BPMNShape id="Participant_1tv1lnj_di" bpmnElement="Participant_1tv1lnj" isHorizontal="true">
        <dc:Bounds x="155" y="107" width="600" height="433" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="228" y="149" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="207" y="119" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0t984kw_di" bpmnElement="Lane_0t984kw" isHorizontal="true">
        <dc:Bounds x="185" y="107" width="570" height="125" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_1eegye4_di" bpmnElement="Lane_1eegye4" isHorizontal="true">
        <dc:Bounds x="185" y="232" width="570" height="125" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0cw9gba_di" bpmnElement="Lane_0cw9gba" isHorizontal="true">
        <dc:Bounds x="185" y="357" width="570" height="183" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0byzagb_di" bpmnElement="SequenceFlow_0byzagb">
        <di:waypoint x="246" y="185" />
        <di:waypoint x="246" y="310" />
        <di:waypoint x="326" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_0d8fcgg_di" bpmnElement="Clerk">
        <dc:Bounds x="326" y="257" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_1bc1826_di" bpmnElement="Approver">
        <dc:Bounds x="326" y="400" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1v2yre2_di" bpmnElement="EndEvent_1v2yre2">
        <dc:Bounds x="688" y="422" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="IntermediateCatchEvent_0tjjngu_di" bpmnElement="IntermediateThrowEvent_0mxbwgy">
        <dc:Bounds x="522" y="142" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0xvu6g6_di" bpmnElement="SequenceFlow_0xvu6g6">
        <di:waypoint x="376" y="337" />
        <di:waypoint x="376" y="400" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="385" y="366" width="49" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_08bp69k_di" bpmnElement="SequenceFlow_08bp69k">
        <di:waypoint x="426" y="440" />
        <di:waypoint x="688" y="440" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="569" y="456" width="82" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1hwdics_di" bpmnElement="SequenceFlow_1hwdics">
        <di:waypoint x="426" y="297" />
        <di:waypoint x="540" y="297" />
        <di:waypoint x="540" y="178" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="460" y="279" width="46" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0ppj3wo_di" bpmnElement="SequenceFlow_0ppj3wo">
        <di:waypoint x="426" y="440" />
        <di:waypoint x="640" y="440" />
        <di:waypoint x="640" y="160" />
        <di:waypoint x="558" y="160" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="510" y="422" width="46" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_0xgo1b6_di" bpmnElement="ExclusiveGateway_0xgo1b6" isMarkerVisible="true">
        <dc:Bounds x="351" y="135" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_08cf9rf_di" bpmnElement="SequenceFlow_08cf9rf">
        <di:waypoint x="522" y="160" />
        <di:waypoint x="401" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_009hwyx_di" bpmnElement="SequenceFlow_009hwyx">
        <di:waypoint x="351" y="160" />
        <di:waypoint x="300" y="160" />
        <di:waypoint x="300" y="290" />
        <di:waypoint x="326" y="290" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="258" y="273" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_07hh4hx_di" bpmnElement="SequenceFlow_07hh4hx">
        <di:waypoint x="351" y="160" />
        <di:waypoint x="280" y="160" />
        <di:waypoint x="280" y="440" />
        <di:waypoint x="326" y="440" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="248" y="453" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
